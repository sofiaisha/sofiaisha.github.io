<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotería de Inteligencia Artificial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: The application is designed as an interactive game board. The main screen is divided into three parts: 1) A control panel to start/reset the game and call the next card. 2) A central display for the currently "called" card, showing its name, icon, and "canto". 3) An interactive grid representing the full 54-card deck. Below this game area, a detailed section displays the expert analysis for the selected card. This structure supports both linear gameplay (calling cards sequentially) and non-linear exploration (clicking any card on the grid to learn about it). Thematic filters are included to allow users to explore concepts by category, enhancing the educational value. This design was chosen to transform the static report into a dynamic, engaging, and multi-purpose learning tool that is both a game and a reference guide. A language switcher has been added to provide a bilingual experience. -->
    <!-- Visualization & Content Choices: Report Info: 54 AI concepts with names, "cantos", and detailed analysis, grouped by theme. Goal: Create an interactive game and educational tool. Viz/Presentation Method: The primary visualization is the interactive 54-card grid, which organizes all concepts. Each card is a button that reveals detailed information. A central display highlights the active card. Simple, abstract icons for each concept are generated dynamically using the HTML Canvas API, avoiding static images or SVG. Detailed text is presented in a dedicated, scrollable section. Interaction: Users can play a guided game ("Siguiente Carta"), explore freely by clicking any card on the grid, or filter the grid by category. Justification: This approach makes the content highly interactive and explorable from multiple angles (gameplay, free exploration, thematic filtering), which is more engaging than a linear document. Library/Method: Vanilla JavaScript for all logic and state management. Tailwind CSS for styling. HTML Canvas for dynamic icon generation. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card-grid-item {
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .card-grid-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .card-grid-item.called {
            opacity: 0.4;
            background-color: #e5e7eb;
            transform: none;
        }
        .card-grid-item.active {
            border-color: #3b82f6;
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.2);
        }
        .card-grid-item.highlight {
            border-color: #f59e0b;
            background-color: #fef3c7;
        }
        .btn-primary {
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        .canto-text {
            font-style: italic;
            font-family: 'Lora', serif;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400;1,400;1,500&display=swap" rel="stylesheet">
</head>
<body class="bg-[#FDFBF8] text-[#333] min-h-screen">

    <div id="app" class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-4">
            <div class="flex justify-end mb-4">
                <div class="relative">
                    <select id="lang-switcher" class="bg-white border border-gray-300 rounded-md py-2 px-4 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="es">Español</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
            <h1 id="main-title" class="text-4xl md:text-5xl font-bold text-[#2c3e50] mb-2"></h1>
            <p id="subtitle" class="text-lg text-[#7f8c8d]"></p>
        </header>

        <main class="bg-white p-6 rounded-2xl shadow-lg">
            <!-- Control and Called Card Section -->
            <section class="flex flex-col md:flex-row gap-6 mb-8">
                <!-- Controls -->
                <div class="md:w-1/3 bg-gray-50 p-6 rounded-xl flex flex-col justify-center items-center text-center">
                    <h2 id="caller-title" class="text-2xl font-bold mb-4 text-[#2c3e50]"></h2>
                    <div id="called-card-display" class="w-full h-48 bg-white rounded-lg flex flex-col justify-center items-center p-4 shadow-inner mb-4">
                        <p id="no-card-message" class="text-gray-500"></p>
                        <div id="card-content" class="hidden text-center">
                            <h3 id="called-card-name" class="text-2xl font-bold text-[#3b82f6]"></h3>
                            <p id="called-card-canto" class="text-md text-gray-600 mt-2 canto-text"></p>
                        </div>
                    </div>
                    <div class="flex space-x-4">
                        <button id="start-button" class="btn-primary bg-[#27ae60] text-white font-bold py-2 px-6 rounded-full shadow-md hover:bg-[#2ecc71]"></button>
                        <button id="reset-button" class="btn-primary bg-[#c0392b] text-white font-bold py-2 px-6 rounded-full shadow-md hover:bg-[#e74c3c]"></button>
                    </div>
                </div>

                <!-- Card Grid -->
                <div class="md:w-2/3">
                    <div id="card-grid" class="grid grid-cols-[repeat(auto-fit,minmax(80px,1fr))] gap-3">
                        <!-- Cards will be generated by JS -->
                    </div>
                </div>
            </section>

            <!-- Filters -->
            <section class="mb-8">
                <h3 id="filter-title" class="text-xl font-bold text-center mb-4 text-[#2c3e50]"></h3>
                <div id="filter-container" class="flex flex-wrap justify-center gap-2">
                    <!-- Filter buttons will be generated by JS -->
                </div>
            </section>

            <!-- Card Details Section -->
            <section id="details-section" class="bg-gray-50 p-6 rounded-xl shadow-inner min-h-[200px]">
                 <div id="details-placeholder" class="flex justify-center items-center h-full">
                    <p id="details-placeholder-text" class="text-gray-500 text-lg"></p>
                </div>
                <article id="details-content" class="hidden prose max-w-none">
                    <h2 id="details-title" class="text-3xl font-bold text-[#3b82f6]"></h2>
                    <p id="details-canto" class="text-lg text-gray-700 mb-4 canto-text"></p>
                    <div id="details-analysis" class="text-base leading-relaxed"></div>
                </article>
            </section>
        </main>

        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p id="footer-text"></p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const translations = {
                es: {
                    mainTitle: "Lotería de IA",
                    subtitle: "Un juego para aprender sobre Inteligencia Artificial",
                    callerTitle: "El Cantor Digital",
                    noCardMessage: 'Presiona "Empezar" para sacar la primera carta.',
                    startButton: "Empezar",
                    nextCardButton: "Siguiente Carta",
                    resetButton: "Reiniciar",
                    filterTitle: "Explorar por Categoría",
                    detailsPlaceholder: "Selecciona una carta del tablero para ver su explicación.",
                    footerText: 'Creado con la magia de la IA. Basado en el manual "Lotería de la Inteligencia Artificial".',
                    allFilter: "Todos",
                    lotteryEndMessage: "¡Lotería! Se han cantado todas las cartas."
                },
                en: {
                    mainTitle: "AI Lottery",
                    subtitle: "A game to learn about Artificial Intelligence",
                    callerTitle: "The Digital Caller",
                    noCardMessage: 'Press "Start" to draw the first card.',
                    startButton: "Start",
                    nextCardButton: "Next Card",
                    resetButton: "Reset",
                    filterTitle: "Explore by Category",
                    detailsPlaceholder: "Select a card from the board to see its explanation.",
                    footerText: 'Created with AI magic. Based on the "Artificial Intelligence Lottery" manual.',
                    allFilter: "All",
                    lotteryEndMessage: "Lottery! All cards have been called."
                }
            };

            const aiConcepts = [
                { id: 1, es: { name: "Inteligencia Artificial", canto: "La que busca en la máquina un reflejo de la vida.", category: "Fundamentos", analysis: "La Inteligencia Artificial (IA) es el campo de la ciencia de la computación dedicado a la creación de máquinas y software que exhiben capacidades tradicionalmente asociadas con la inteligencia humana..." }, en: { name: "Artificial Intelligence", canto: "The one that seeks in the machine a reflection of life.", category: "Fundamentals", analysis: "Artificial Intelligence (AI) is the field of computer science dedicated to creating machines and software that exhibit capabilities traditionally associated with human intelligence..." } },
                { id: 2, es: { name: "Algoritmo", canto: "El que marca el paso a paso, sin descanso ni retraso.", category: "Fundamentos", analysis: "Un algoritmo es una serie de instrucciones o reglas finitas, bien definidas y ordenadas, diseñadas para realizar una tarea específica o resolver un problema..." }, en: { name: "Algorithm", canto: "The one that sets the step-by-step, without rest or delay.", category: "Fundamentals", analysis: "An algorithm is a series of finite, well-defined, and ordered instructions or rules designed to perform a specific task or solve a problem..." } },
                { id: 3, es: { name: "Big Data", canto: "El océano de datos donde el conocimiento nada.", category: "Fundamentos", analysis: "El término Big Data se refiere a conjuntos de datos digitales cuyo volumen, velocidad y variedad superan la capacidad de las herramientas de software tradicionales para ser capturados, gestionados y procesados en un tiempo razonable..." }, en: { name: "Big Data", canto: "The ocean of data where knowledge swims.", category: "Fundamentals", analysis: "The term Big Data refers to digital data sets whose volume, velocity, and variety exceed the capacity of traditional software tools to be captured, managed, and processed in a reasonable time..." } },
                { id: 4, es: { name: "Ciencia de Datos", canto: "La que extrae la joya del fondo de la mina.", category: "Fundamentos", analysis: "La Ciencia de Datos es un campo interdisciplinario que utiliza métodos científicos, procesos, algoritmos y sistemas para extraer conocimiento e insights de datos en sus diversas formas..." }, en: { name: "Data Science", canto: "The one that extracts the jewel from the bottom of the mine.", category: "Fundamentals", analysis: "Data Science is an interdisciplinary field that uses scientific methods, processes, algorithms, and systems to extract knowledge and insights from data in its various forms..." } },
                { id: 5, es: { name: "Minería de Datos", canto: "Buscando patrones y vetas, descubre lo que no aparentas.", category: "Fundamentos", analysis: "La Minería de Datos es el proceso de descubrir patrones, correlaciones y conocimiento útil en grandes conjuntos de datos utilizando técnicas estadísticas y de inteligencia artificial..." }, en: { name: "Data Mining", canto: "Searching for patterns and veins, it discovers what you don't seem to be.", category: "Fundamentals", analysis: "Data Mining is the process of discovering patterns, correlations, and useful knowledge in large data sets using statistical and artificial intelligence techniques..." } },
                { id: 6, es: { name: "Aprendizaje Automático", canto: "El que aprende del pasado para un futuro bien trazado.", category: "Aprendizaje", analysis: "El Aprendizaje Automático (Machine Learning, ML) es un subconjunto de la IA que se centra en el desarrollo de algoritmos que permiten a las computadoras aprender directamente de los datos y la experiencia, sin ser programadas explícitamente para cada tarea." }, en: { name: "Machine Learning", canto: "The one that learns from the past for a well-drawn future.", category: "Learning", analysis: "Machine Learning (ML) is a subset of AI that focuses on developing algorithms that allow computers to learn directly from data and experience, without being explicitly programmed for each task." } },
                { id: 7, es: { name: "Aprendizaje Supervisado", canto: "Con el maestro a su lado, aprende lo ya etiquetado.", category: "Aprendizaje", analysis: "El Aprendizaje Supervisado es el paradigma de ML más común. Se define por el uso de conjuntos de datos etiquetados para entrenar algoritmos. El modelo recibe datos de entrada junto con la salida correcta correspondiente." }, en: { name: "Supervised Learning", canto: "With the teacher by its side, it learns what's already labeled.", category: "Learning", analysis: "Supervised Learning is the most common ML paradigm. It is defined by the use of labeled datasets to train algorithms. The model receives input data along with the corresponding correct output." } },
                { id: 8, es: { name: "Aprendizaje no Supervisado", canto: "Solo en la multitud, encuentra la similitud.", category: "Aprendizaje", analysis: "En el Aprendizaje no Supervisado, el modelo se entrena con datos que no han sido etiquetados ni clasificados. La tarea del algoritmo es explorar los datos por sí mismo y descubrir patrones o estructuras ocultas." }, en: { name: "Unsupervised Learning", canto: "Alone in the crowd, it finds the similarity.", category: "Learning", analysis: "In Unsupervised Learning, the model is trained with data that has not been labeled or classified. The algorithm's task is to explore the data on its own and discover hidden patterns or structures." } },
                { id: 9, es: { name: "Aprendizaje por Refuerzo", canto: "A base de prueba y error, se hace diestro y sabedor.", category: "Aprendizaje", analysis: "En el Aprendizaje por Refuerzo, un agente de IA aprende a tomar decisiones interactuando con un entorno. Realiza acciones y recibe a cambio recompensas o penalizaciones, aprendiendo la estrategia que maximiza la recompensa total." }, en: { name: "Reinforcement Learning", canto: "Through trial and error, it becomes skilled and knowledgeable.", category: "Learning", analysis: "In Reinforcement Learning, an AI agent learns to make decisions by interacting with an environment. It performs actions and receives rewards or penalties in return, learning the strategy that maximizes the total reward." } },
                { id: 10, es: { name: "Aprendizaje Semisupervisado", canto: "Con poquita ayuda, resuelve la gran duda.", category: "Aprendizaje", analysis: "El Aprendizaje Semisupervisado es un punto intermedio que se utiliza cuando se dispone de una gran cantidad de datos sin etiquetar y solo una pequeña cantidad de datos etiquetados, usando los segundos para guiar el aprendizaje sobre los primeros." }, en: { name: "Semi-Supervised Learning", canto: "With a little help, it solves the great doubt.", category: "Learning", analysis: "Semi-Supervised Learning is a middle ground used when there is a large amount of unlabeled data and only a small amount of labeled data, using the latter to guide learning on the former." } },
                { id: 11, es: { name: "Modelo Predictivo", canto: "El que adivina tu suerte, con los datos se hace fuerte.", category: "Aprendizaje", analysis: "Un Modelo Predictivo es el resultado que se genera cuando un algoritmo de aprendizaje automático se entrena con datos. Está diseñado para hacer predicciones sobre datos nuevos basándose en patrones históricos." }, en: { name: "Predictive Model", canto: "The one that tells your fortune, with data it grows strong.", category: "Learning", analysis: "A Predictive Model is the result generated when a machine learning algorithm is trained with data. It is designed to make predictions about new data based on historical patterns." } },
                { id: 12, es: { name: "Simulación", canto: "El mundo de mentiritas, donde el robot se ejercita.", category: "Aprendizaje", analysis: "Una simulación es un entorno virtual utilizado como campo de entrenamiento seguro y eficiente, especialmente para algoritmos de aprendizaje por refuerzo. Permite a un agente de IA experimentar millones de escenarios rápidamente y sin consecuencias en el mundo real." }, en: { name: "Simulation", canto: "The make-believe world, where the robot trains.", category: "Learning", analysis: "A simulation is a virtual environment used as a safe and efficient training ground, especially for reinforcement learning algorithms. It allows an AI agent to experience millions of scenarios quickly and without real-world consequences." } },
                { id: 13, es: { name: "Red Neuronal", canto: "La telaraña de nudos que piensa por todos los modos.", category: "Redes Neuronales", analysis: "Una Red Neuronal Artificial (RNA) es un modelo computacional inspirado en el cerebro humano, compuesto por nodos de procesamiento interconectados (neuronas) organizados en capas. Es fundamental para el Deep Learning." }, en: { name: "Neural Network", canto: "The web of nodes that thinks in every way.", category: "Neural Networks", analysis: "An Artificial Neural Network (ANN) is a computational model inspired by the human brain, composed of interconnected processing nodes (neurons) organized in layers. It is fundamental to Deep Learning." } },
                { id: 14, es: { name: "Deep Learning", canto: "Con sus capas profundas, los misterios circundas.", category: "Redes Neuronales", analysis: "El Aprendizaje Profundo (Deep Learning) es un subcampo del ML que utiliza redes neuronales con muchas capas ocultas ('profundas'), permitiendo aprender jerarquías de características muy complejas. Es la técnica detrás de los avances más impresionantes de la IA reciente." }, en: { name: "Deep Learning", canto: "With its deep layers, you surround the mysteries.", category: "Neural Networks", analysis: "Deep Learning is a subfield of ML that uses neural networks with many hidden layers ('deep'), allowing it to learn very complex feature hierarchies. It is the technique behind the most impressive recent advances in AI." } },
                { id: 15, es: { name: "Perceptrón", canto: "La neurona solitaria, la idea más primaria.", category: "Redes Neuronales", analysis: "El Perceptrón es el componente más básico de una red neuronal, una única neurona artificial. Toma varias entradas, les asigna un peso y produce una única salida binaria si se supera un umbral." }, en: { name: "Perceptron", canto: "The solitary neuron, the most primary idea.", category: "Neural Networks", analysis: "The Perceptron is the most basic component of a neural network, a single artificial neuron. It takes several inputs, assigns them a weight, and produces a single binary output if a threshold is exceeded." } },
                { id: 16, es: { name: "Backpropagation", canto: "Corrigiendo hacia atrás, el error no vuelve más.", category: "Redes Neuronales", analysis: "La Retropropagación (Backpropagation) es el algoritmo clave para entrenar redes neuronales. Funciona calculando el error en la salida y propagándolo hacia atrás a través de la red para ajustar los pesos de las conexiones y mejorar la precisión." }, en: { name: "Backpropagation", canto: "Correcting backwards, the error never returns.", category: "Neural Networks", analysis: "Backpropagation is the key algorithm for training neural networks. It works by calculating the error at the output and propagating it backward through the network to adjust the connection weights and improve accuracy." } },
                { id: 17, es: { name: "Función de Activación", canto: "El interruptor del seso, que da inicio al proceso.", category: "Redes Neuronales", analysis: "La Función de Activación es un componente matemático que introduce no linealidad en una red neuronal, permitiéndole aprender patrones complejos. Decide la 'fuerza' de la señal que una neurona envía a la siguiente capa." }, en: { name: "Activation Function", canto: "The brain's switch, that starts the process.", category: "Neural Networks", analysis: "The Activation Function is a mathematical component that introduces non-linearity into a neural network, allowing it to learn complex patterns. It decides the 'strength' of the signal a neuron sends to the next layer." } },
                { id: 18, es: { name: "Sobreajuste", canto: "El que memoriza tanto, que en lo nuevo causa espanto.", category: "Redes Neuronales", analysis: "El Sobreajuste (Overfitting) ocurre cuando un modelo aprende los datos de entrenamiento 'demasiado bien', incluyendo el ruido, y como resultado, no generaliza bien a datos nuevos. Falla al hacer predicciones sobre información que no ha visto antes." }, en: { name: "Overfitting", canto: "The one that memorizes so much, that it frightens with the new.", category: "Neural Networks", analysis: "Overfitting occurs when a model learns the training data 'too well', including noise, and as a result, does not generalize well to new data. It fails when making predictions on information it has not seen before." } },
                { id: 19, es: { name: "Procesamiento del Lenguaje Natural", canto: "El que entiende lo que hablamos y traduce los arcanos.", category: "Lenguaje", analysis: "El Procesamiento del Lenguaje Natural (PLN) es una rama de la IA que se ocupa de la interacción entre las computadoras y el lenguaje humano. Su objetivo es permitir que las máquinas 'lean', entiendan, interpreten y generen lenguaje humano." }, en: { name: "Natural Language Processing", canto: "The one that understands what we speak and translates the arcane.", category: "Language", analysis: "Natural Language Processing (NLP) is a branch of AI that deals with the interaction between computers and human language. Its goal is to enable machines to 'read', understand, interpret, and generate human language." } },
                { id: 20, es: { name: "Modelo de Lenguaje Grande", canto: "El gigante de las letras, que con todas te penetra.", category: "Lenguaje", analysis: "Un Modelo de Lenguaje Grande (LLM) es un modelo de IA avanzado entrenado con cantidades masivas de texto. Aprende patrones, gramática y matices del lenguaje para generar texto coherente y contextualmente apropiado, como la serie GPT o Gemini." }, en: { name: "Large Language Model", canto: "The giant of letters, that penetrates you with all of them.", category: "Language", analysis: "A Large Language Model (LLM) is an advanced AI model trained on massive amounts of text. It learns patterns, grammar, and nuances of language to generate coherent and contextually appropriate text, like the GPT or Gemini series." } },
                { id: 21, es: { name: "Chatbot", canto: "El amigo que contesta, sin cansancio y siempre en fiesta.", category: "Lenguaje", analysis: "Un Chatbot es un programa de IA diseñado para simular una conversación humana. Los chatbots modernos, impulsados por LLMs, pueden mantener conversaciones abiertas sobre casi cualquier tema." }, en: { name: "Chatbot", canto: "The friend who answers, tireless and always festive.", category: "Language", analysis: "A Chatbot is an AI program designed to simulate human conversation. Modern chatbots, powered by LLMs, can hold open-ended conversations on almost any topic." } },
                { id: 22, es: { name: "Análisis de Sentimientos", canto: "El que mide la alegría o la triste melancolía.", category: "Lenguaje", analysis: "El Análisis de Sentimientos es una técnica de PLN para identificar y cuantificar el tono emocional (positivo, negativo, neutro) en un texto. Es muy usado para analizar opiniones de clientes en redes sociales o reseñas de productos." }, en: { name: "Sentiment Analysis", canto: "The one that measures joy or sad melancholy.", category: "Language", analysis: "Sentiment Analysis is an NLP technique to identify and quantify the emotional tone (positive, negative, neutral) in a text. It is widely used to analyze customer opinions on social media or product reviews." } },
                { id: 23, es: { name: "Tokenización", canto: "La palabra en pedacitos, para entender sus escritos.", category: "Lenguaje", analysis: "La Tokenización es el proceso de dividir un texto en unidades más pequeñas llamadas 'tokens' (palabras, números, puntuación). Es un primer paso fundamental para que las máquinas puedan procesar el lenguaje." }, en: { name: "Tokenization", canto: "The word in little pieces, to understand its writings.", category: "Language", analysis: "Tokenization is the process of dividing a text into smaller units called 'tokens' (words, numbers, punctuation). It is a fundamental first step for machines to be able to process language." } },
                { id: 24, es: { name: "Generación de Lenguaje Natural", canto: "El que escribe los reportes, con sus datos por soportes.", category: "Lenguaje", analysis: "La Generación de Lenguaje Natural (NLG) es el subcampo del PLN que se enfoca en producir texto similar al humano a partir de datos estructurados. Es la tecnología que permite a la IA 'escribir' o 'hablar'." }, en: { name: "Natural Language Generation", canto: "The one that writes the reports, with its data as support.", category: "Language", analysis: "Natural Language Generation (NLG) is the subfield of NLP that focuses on producing human-like text from structured data. It is the technology that allows AI to 'write' or 'speak'." } },
                { id: 25, es: { name: "RAG (Generación Aumentada)", canto: "El que busca en la fuente externa, para que su saber no inverna.", category: "Lenguaje", analysis: "La Generación Aumentada por Recuperación (RAG) es una técnica que mejora los LLMs combinándolos con un sistema de recuperación de información en tiempo real. Permite al modelo acceder a conocimiento externo y actualizado para dar respuestas más precisas y fiables." }, en: { name: "RAG (Augmented Generation)", canto: "The one that seeks in the external source, so its knowledge doesn't hibernate.", category: "Language", analysis: "Retrieval-Augmented Generation (RAG) is a technique that improves LLMs by combining them with a real-time information retrieval system. It allows the model to access external and updated knowledge to provide more accurate and reliable answers." } },
                { id: 26, es: { name: "Visión por Computadora", canto: "Los ojos de la corriente, que ven lo que el humano siente.", category: "Visión y Robótica", analysis: "La Visión por Computadora es un campo de la IA que entrena a las computadoras para interpretar y comprender el mundo visual. Permite a las máquinas identificar objetos, personas, texto y reaccionar a lo que 'ven'." }, en: { name: "Computer Vision", canto: "The eyes of the current, that see what the human feels.", category: "Vision & Robotics", analysis: "Computer Vision is a field of AI that trains computers to interpret and understand the visual world. It allows machines to identify objects, people, text, and react to what they 'see'." } },
                { id: 27, es: { name: "Detección de Objetos", canto: "Te dice qué es y dónde está, con un cuadro lo pondrá.", category: "Visión y Robótica", analysis: "La Detección de Objetos es una tarea de visión por computadora que identifica y localiza objetos dentro de una imagen, generalmente dibujando un cuadro delimitador a su alrededor. Es clave para los vehículos autónomos." }, en: { name: "Object Detection", canto: "It tells you what it is and where it is, with a box it will place it.", category: "Vision & Robotics", analysis: "Object Detection is a computer vision task that identifies and locates objects within an image, usually by drawing a bounding box around them. It is key for autonomous vehicles." } },
                { id: 28, es: { name: "Reconocimiento Facial", canto: "El que conoce tu cara, y de nadie la separa.", category: "Visión y Robótica", analysis: "El Reconocimiento Facial es una aplicación que identifica o verifica la identidad de una persona a partir de una imagen. Analiza características geométricas del rostro para crear una 'huella facial' única." }, en: { name: "Facial Recognition", canto: "The one that knows your face, and separates it from no one.", category: "Vision & Robotics", analysis: "Facial Recognition is an application that identifies or verifies a person's identity from an image. It analyzes geometric features of the face to create a unique 'facial print'." } },
                { id: 29, es: { name: "Reconocimiento Óptico de Caracteres", canto: "El que lee la foto impresa, y en texto te la regresa.", category: "Visión y Robótica", analysis: "El Reconocimiento Óptico de Caracteres (OCR) convierte documentos escaneados, PDFs o imágenes en texto editable y con capacidad de búsqueda. Permite a una computadora 'leer' texto impreso." }, en: { name: "Optical Character Recognition", canto: "The one that reads the printed photo, and returns it to you in text.", category: "Vision & Robotics", analysis: "Optical Character Recognition (OCR) converts scanned documents, PDFs, or images into editable and searchable text. It allows a computer to 'read' printed text." } },
                { id: 30, es: { name: "Segmentación de Imágenes", canto: "Delineando el contorno, píxel a píxel, sin soborno.", category: "Visión y Robótica", analysis: "La Segmentación de Imágenes divide una imagen en múltiples segmentos a nivel de píxel, asignando cada píxel a una clase de objeto. Proporciona un entendimiento mucho más detallado de la escena que la detección de objetos." }, en: { name: "Image Segmentation", canto: "Delineating the contour, pixel by pixel, without a bribe.", category: "Vision & Robotics", analysis: "Image Segmentation divides an image into multiple segments at the pixel level, assigning each pixel to an object class. It provides a much more detailed understanding of the scene than object detection." } },
                { id: 31, es: { name: "Robótica", canto: "El cuerpo de metal y cable, que hace el trabajo incansable.", category: "Visión y Robótica", analysis: "La Robótica es la rama de la ingeniería que se ocupa del diseño, construcción y uso de robots. La IA proporciona el 'cerebro' que permite a los robots modernos percibir, decidir y adaptarse a su entorno." }, en: { name: "Robotics", canto: "The body of metal and wire, that does the tireless work.", category: "Vision & Robotics", analysis: "Robotics is the branch of engineering that deals with the design, construction, and use of robots. AI provides the 'brain' that allows modern robots to perceive, decide, and adapt to their environment." } },
                { id: 32, es: { name: "Vehículos Autónomos", canto: "El carro que va solito, siguiendo su propio rito.", category: "Visión y Robótica", analysis: "Los Vehículos Autónomos utilizan una combinación de sensores (cámaras, LiDAR) y algoritmos de IA para percibir su entorno y navegar de forma segura sin intervención humana. Son una de las aplicaciones más complejas de la IA." }, en: { name: "Autonomous Vehicles", canto: "The car that goes alone, following its own rite.", category: "Vision & Robotics", analysis: "Autonomous Vehicles use a combination of sensors (cameras, LiDAR) and AI algorithms to perceive their environment and navigate safely without human intervention. They are one of the most complex applications of AI." } },
                { id: 33, es: { name: "Internet de las Cosas", canto: "La red de objetos parlantes, siempre activos y vigilantes.", category: "Visión y Robótica", analysis: "El Internet de las Cosas (IoT) es la red de dispositivos físicos conectados a internet que recopilan y comparten datos. El IoT proporciona los datos del mundo real, y la IA los analiza para tomar decisiones inteligentes." }, en: { name: "Internet of Things", canto: "The network of talking objects, always active and vigilant.", category: "Vision & Robotics", analysis: "The Internet of Things (IoT) is the network of physical devices connected to the internet that collect and share data. IoT provides real-world data, and AI analyzes it to make intelligent decisions." } },
                { id: 34, es: { name: "Efector Final", canto: "La mano del autómata, que sujeta, suelda o ata.", category: "Visión y Robótica", analysis: "En robótica, el Efector Final es la herramienta en el extremo del brazo de un robot (pinzas, pistolas de soldar, etc.). Es el componente que interactúa directamente con el entorno para realizar una tarea." }, en: { name: "End-Effector", canto: "The automaton's hand, that grips, welds, or ties.", category: "Vision & Robotics", analysis: "In robotics, the End-Effector is the tool at the end of a robot's arm (grippers, welding guns, etc.). It is the component that directly interacts with the environment to perform a task." } },
                { id: 35, es: { name: "Automatización", canto: "La tarea que antes hacías, ahora la mandan las frías.", category: "Visión y Robótica", analysis: "La Automatización es el uso de la tecnología para realizar tareas que antes requerían intervención humana. La IA permite la 'automatización inteligente', abordando tareas complejas que requieren juicio y adaptación." }, en: { name: "Automation", canto: "The task you used to do, now the cold ones command it.", category: "Vision & Robotics", analysis: "Automation is the use of technology to perform tasks that previously required human intervention. AI enables 'intelligent automation', addressing complex tasks that require judgment and adaptation." } },
                { id: 36, es: { name: "Transformer", canto: "El arquitecto del verbo, que hizo al lenguaje su siervo.", category: "Herramientas", analysis: "La arquitectura Transformer es un tipo de red neuronal que revolucionó el PLN. Su 'mecanismo de atención' le permite procesar todas las palabras de una oración simultáneamente, capturando el contexto complejo de manera muy eficaz. Es la base de los LLMs como GPT." }, en: { name: "Transformer", canto: "The architect of the verb, who made language his servant.", category: "Tools", analysis: "The Transformer architecture is a type of neural network that revolutionized NLP. Its 'attention mechanism' allows it to process all words in a sentence simultaneously, capturing complex context very effectively. It is the basis of LLMs like GPT." } },
                { id: 37, es: { name: "API", canto: "La puerta siempre entreabierta, para la función correcta.", category: "Herramientas", analysis: "Una API (Interfaz de Programación de Aplicaciones) permite que diferentes programas de software se comuniquen entre sí. En IA, las APIs permiten a los desarrolladores integrar modelos potentes (como GPT-4) en sus propias aplicaciones fácilmente." }, en: { name: "API", canto: "The ever-open door, for the right function.", category: "Tools", analysis: "An API (Application Programming Interface) allows different software programs to communicate with each other. In AI, APIs allow developers to easily integrate powerful models (like GPT-4) into their own applications." } },
                { id: 38, es: { name: "TensorFlow", canto: "El motor de Google, potente, para entrenar a la mente.", category: "Herramientas", analysis: "TensorFlow es una biblioteca de software de código abierto de Google para el aprendizaje automático. Es una de las plataformas más potentes para construir y entrenar modelos de Deep Learning a gran escala." }, en: { name: "TensorFlow", canto: "Google's engine, powerful, to train the mind.", category: "Tools", analysis: "TensorFlow is an open-source software library from Google for machine learning. It is one of the most powerful platforms for building and training large-scale Deep Learning models." } },
                { id: 39, es: { name: "Keras", canto: "La capa que lo hace fácil, para un modelo más grácil.", category: "Herramientas", analysis: "Keras es una API de alto nivel para redes neuronales que se ejecuta sobre frameworks como TensorFlow. Su filosofía es la facilidad de uso y la creación rápida de prototipos, haciendo el Deep Learning más accesible." }, en: { name: "Keras", canto: "The layer that makes it easy, for a more graceful model.", category: "Tools", analysis: "Keras is a high-level API for neural networks that runs on top of frameworks like TensorFlow. Its philosophy is ease of use and rapid prototyping, making Deep Learning more accessible." } },
                { id: 40, es: { name: "Red Generativa Antagónica", canto: "El pintor y el policía, creando con maestría.", category: "Herramientas", analysis: "Una Red Generativa Antagónica (GAN) consta de dos redes neuronales que compiten: un Generador que crea datos falsos y un Discriminador que intenta detectarlos. Este juego adversarial resulta en la creación de datos sintéticos muy realistas." }, en: { name: "Generative Adversarial Network", canto: "The painter and the policeman, creating with mastery.", category: "Tools", analysis: "A Generative Adversarial Network (GAN) consists of two competing neural networks: a Generator that creates fake data and a Discriminator that tries to detect it. This adversarial game results in the creation of very realistic synthetic data." } },
                { id: 41, es: { name: "Aumento de Datos", canto: "Si los datos no te alcanzan, con este truco se amansan.", category: "Herramientas", analysis: "El Aumento de Datos es una técnica para incrementar artificialmente el tamaño de un conjunto de datos de entrenamiento. Se aplican transformaciones aleatorias (rotación, recorte, etc.) a los datos existentes para crear nuevas muestras y mejorar la robustez del modelo." }, en: { name: "Data Augmentation", canto: "If the data is not enough, with this trick it is tamed.", category: "Tools", analysis: "Data Augmentation is a technique to artificially increase the size of a training dataset. Random transformations (rotation, cropping, etc.) are applied to existing data to create new samples and improve model robustness." } },
                { id: 42, es: { name: "Prueba de Turing", canto: "El juego del escondite, a ver si la máquina emite.", category: "Conceptos Avanzados", analysis: "La Prueba de Turing es un test para evaluar la capacidad de una máquina de exhibir un comportamiento inteligente indistinguible del de un ser humano en una conversación. Mide la simulación de la inteligencia, no la conciencia." }, en: { name: "Turing Test", canto: "The game of hide-and-seek, to see if the machine emits.", category: "Advanced Concepts", analysis: "The Turing Test is a test to evaluate a machine's ability to exhibit intelligent behavior indistinguishable from that of a human in a conversation. It measures the simulation of intelligence, not consciousness." } },
                { id: 43, es: { name: "Alucinación", canto: "El que inventa con certeza, aunque no tenga cabeza.", category: "Conceptos Avanzados", analysis: "Una 'alucinación' en IA es una respuesta generada por un modelo que es incorrecta o inventada, pero presentada con confianza. Ocurre porque los LLMs son modelos probabilísticos y a veces la secuencia de palabras más probable no se corresponde con la realidad." }, en: { name: "Hallucination", canto: "The one that invents with certainty, even without a head.", category: "Advanced Concepts", analysis: "An 'hallucination' in AI is a response generated by a model that is incorrect or invented, but presented with confidence. It occurs because LLMs are probabilistic models and sometimes the most likely sequence of words does not correspond to reality." } },
                { id: 44, es: { name: "Caja Negra", canto: "El sistema que decide, pero su razón la elide.", category: "Conceptos Avanzados", analysis: "Una 'Caja Negra' describe un sistema de IA cuyo proceso de toma de decisiones es opaco e inescrutable para los humanos. Podemos ver la entrada y la salida, pero no entender fácilmente el 'cómo' o el 'porqué' de la decisión." }, en: { name: "Black Box", canto: "The system that decides, but its reason it elides.", category: "Advanced Concepts", analysis: "A 'Black Box' describes an AI system whose decision-making process is opaque and inscrutable to humans. We can see the input and the output, but not easily understand the 'how' or 'why' of the decision." } },
                { id: 45, es: { name: "Singularidad Tecnológica", canto: "El día en que la creación, supere a la razón.", category: "Conceptos Avanzados", analysis: "La Singularidad Tecnológica es un punto hipotético en el futuro en el que el crecimiento tecnológico, impulsado por una IA capaz de auto-mejorarse, se vuelve incontrolable y da lugar a cambios imprevisibles en la civilización humana." }, en: { name: "Technological Singularity", canto: "The day creation surpasses reason.", category: "Advanced Concepts", analysis: "The Technological Singularity is a hypothetical point in the future where technological growth, driven by a self-improving AI, becomes uncontrollable and leads to unforeseeable changes in human civilization." } },
                { id: 46, es: { name: "Inteligencia Artificial General", canto: "La que todo lo sabría, como un humano lo haría.", category: "Conceptos Avanzados", analysis: "La Inteligencia Artificial General (IAG) se refiere a una IA hipotética que posee la capacidad de entender, aprender y aplicar su conocimiento en una amplia gama de tareas al nivel de un ser humano, a diferencia de la 'IA Estrecha' actual, que es especializada." }, en: { name: "Artificial General Intelligence", canto: "The one that would know everything, as a human would.", category: "Advanced Concepts", analysis: "Artificial General Intelligence (AGI) refers to a hypothetical AI that has the ability to understand, learn, and apply its knowledge across a wide range of tasks at a human level, unlike the current 'Narrow AI', which is specialized." } },
                { id: 47, es: { name: "Interfaz Cerebro-Computadora", canto: "El puente entre pensamiento y el digital firmamento.", category: "Conceptos Avanzados", analysis: "Una Interfaz Cerebro-Computadora (BCI) es una tecnología que establece un canal de comunicación directo entre el cerebro y un dispositivo externo, permitiendo controlar tecnología con el pensamiento. Tiene aplicaciones revolucionarias en medicina." }, en: { name: "Brain-Computer Interface", canto: "The bridge between thought and the digital firmament.", category: "Advanced Concepts", analysis: "A Brain-Computer Interface (BCI) is a technology that establishes a direct communication channel between the brain and an external device, allowing technology to be controlled by thought. It has revolutionary applications in medicine." } },
                { id: 48, es: { name: "Ética de la IA", canto: "La conciencia del programa, que lo justo proclama.", category: "Ética", analysis: "La Ética de la IA es el campo que se ocupa de los principios morales y los problemas éticos del diseño, desarrollo y uso de la IA. Busca garantizar que la tecnología sea justa, transparente, responsable y respetuosa con los derechos humanos." }, en: { name: "AI Ethics", canto: "The program's conscience, that proclaims what is just.", category: "Ethics", analysis: "AI Ethics is the field that deals with the moral principles and ethical problems of the design, development, and use of AI. It seeks to ensure that the technology is fair, transparent, responsible, and respectful of human rights." } },
                { id: 49, es: { name: "Sesgo", canto: "El prejuicio en el dato, que da un resultado ingrato.", category: "Ética", analysis: "El sesgo algorítmico se refiere a la tendencia de un sistema de IA a producir resultados sistemáticamente perjudiciales contra ciertos grupos. Surge cuando los datos de entrenamiento reflejan prejuicios sociales existentes, que el modelo aprende y a menudo amplifica." }, en: { name: "Bias", canto: "The prejudice in the data, that gives an ungrateful result.", category: "Ethics", analysis: "Algorithmic bias refers to the tendency of an AI system to produce systematically harmful results against certain groups. It arises when training data reflects existing social prejudices, which the model learns and often amplifies." } },
                { id: 50, es: { name: "Transparencia", canto: "El que muestra sus entrañas, para evitar las patrañas.", category: "Ética", analysis: "La Transparencia es un principio ético que exige que el funcionamiento de un sistema de IA, sus datos y su proceso de decisión sean abiertos y comprensibles. Es un requisito previo para la confianza y la rendición de cuentas." }, en: { name: "Transparency", canto: "The one that shows its entrails, to avoid the tricks.", category: "Ethics", analysis: "Transparency is an ethical principle that requires the operation of an AI system, its data, and its decision-making process to be open and understandable. It is a prerequisite for trust and accountability." } },
                { id: 51, es: { name: "IA Explicable", canto: "La que cuenta su porqué, para que le tengas fe.", category: "Ética", analysis: "La IA Explicable (XAI) es un conjunto de técnicas destinadas a desarrollar sistemas de IA cuyas decisiones puedan ser entendidas por los humanos. Es la respuesta técnica al problema de la 'caja negra', crucial para la confianza en ámbitos de alto riesgo." }, en: { name: "Explainable AI", canto: "The one that tells its why, so you can have faith in it.", category: "Ethics", analysis: "Explainable AI (XAI) is a set of techniques aimed at developing AI systems whose decisions can be understood by humans. It is the technical answer to the 'black box' problem, crucial for trust in high-risk areas." } },
                { id: 52, es: { name: "Privacidad", canto: "El tesoro personal, que no debe tocar el mal.", category: "Ética", analysis: "La Privacidad es un derecho fundamental y un principio ético central en la IA. Se refiere a la protección de los datos personales y la capacidad de los individuos para controlar su información, un desafío clave dado que la IA es 'hambrienta de datos'." }, en: { name: "Privacy", canto: "The personal treasure, that evil must not touch.", category: "Ethics", analysis: "Privacy is a fundamental right and a central ethical principle in AI. It refers to the protection of personal data and the ability of individuals to control their information, a key challenge given that AI is 'data-hungry'." } },
                { id: 53, es: { name: "Responsabilidad", canto: "Si la máquina se equivoca, ¿a qué humano le toca?", category: "Ética", analysis: "La Responsabilidad (Accountability) es el principio ético que busca establecer líneas claras de atribución de responsabilidad por los resultados de la IA. Plantea la difícil pregunta de quién es responsable cuando un sistema autónomo comete un error." }, en: { name: "Accountability", canto: "If the machine makes a mistake, which human is to blame?", category: "Ethics", analysis: "Accountability is the ethical principle that seeks to establish clear lines of responsibility for the results of AI. It raises the difficult question of who is responsible when an autonomous system makes a mistake." } },
                { id: 54, es: { name: "Gobernanza de Datos", canto: "Las reglas del gran tesoro, para usarlo con decoro.", category: "Ética", analysis: "La Gobernanza de Datos es el proceso de gestión de la disponibilidad, usabilidad, integridad y seguridad de los datos. En IA, es el marco que garantiza que los datos se gestionen de manera ética y responsable, siendo la base para mitigar riesgos como el sesgo." }, en: { name: "Data Governance", canto: "The rules of the great treasure, to use it with decorum.", category: "Ethics", analysis: "Data Governance is the process of managing the availability, usability, integrity, and security of data. In AI, it is the framework that ensures data is managed ethically and responsibly, being the basis for mitigating risks like bias." } },
            ];

            let state = {
                gameRunning: false,
                availableCards: [],
                calledCards: [],
                currentCard: null,
                activeFilter: 'All',
                lang: 'es'
            };

            const langSwitcher = document.getElementById('lang-switcher');
            const mainTitle = document.getElementById('main-title');
            const subtitle = document.getElementById('subtitle');
            const callerTitle = document.getElementById('caller-title');
            const noCardMessage = document.getElementById('no-card-message');
            const startButton = document.getElementById('start-button');
            const resetButton = document.getElementById('reset-button');
            const filterTitle = document.getElementById('filter-title');
            const detailsPlaceholderText = document.getElementById('details-placeholder-text');
            const footerText = document.getElementById('footer-text');
            
            const cardGrid = document.getElementById('card-grid');
            const cardContent = document.getElementById('card-content');
            const calledCardName = document.getElementById('called-card-name');
            const calledCardCanto = document.getElementById('called-card-canto');
            const detailsPlaceholder = document.getElementById('details-placeholder');
            const detailsContent = document.getElementById('details-content');
            const detailsTitle = document.getElementById('details-title');
            const detailsCanto = document.getElementById('details-canto');
            const detailsAnalysis = document.getElementById('details-analysis');
            const filterContainer = document.getElementById('filter-container');

            function setLanguage(lang) {
                state.lang = lang;
                document.documentElement.lang = lang;
                const t = translations[lang];

                mainTitle.textContent = t.mainTitle;
                subtitle.textContent = t.subtitle;
                callerTitle.textContent = t.callerTitle;
                noCardMessage.textContent = t.noCardMessage;
                startButton.textContent = state.gameRunning ? t.nextCardButton : t.startButton;
                resetButton.textContent = t.resetButton;
                filterTitle.textContent = t.filterTitle;
                detailsPlaceholderText.textContent = t.detailsPlaceholder;
                footerText.textContent = t.footerText;
                
                state.activeFilter = (lang === 'es' && state.activeFilter === 'All') ? 'Todos' : state.activeFilter;
                state.activeFilter = (lang === 'en' && state.activeFilter === 'Todos') ? 'All' : state.activeFilter;
                
                renderGrid();
                setupFilters();
                if (state.currentCard) {
                    showDetails(state.currentCard.id);
                    updateCalledCardDisplay(state.currentCard);
                }
            }

            function init() {
                const userLang = navigator.language.split('-')[0];
                const initialLang = userLang === 'en' ? 'en' : 'es';
                langSwitcher.value = initialLang;
                setLanguage(initialLang);
                
                resetGame();
            }

            function renderGrid() {
                cardGrid.innerHTML = '';
                aiConcepts.forEach(concept => {
                    const cardData = concept[state.lang];
                    const cardEl = document.createElement('button');
                    cardEl.className = 'card-grid-item border-2 border-transparent bg-white rounded-lg p-2 aspect-square flex flex-col justify-center items-center text-center cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-400';
                    cardEl.dataset.id = concept.id;
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = 40;
                    canvas.height = 40;
                    cardEl.appendChild(canvas);
                    generateIcon(canvas, cardData.name);

                    const nameEl = document.createElement('span');
                    nameEl.className = 'text-xs mt-1 font-semibold text-gray-700';
                    nameEl.textContent = cardData.name;
                    cardEl.appendChild(nameEl);

                    cardEl.addEventListener('click', () => showDetails(concept.id));
                    cardGrid.appendChild(cardEl);
                });
                updateCardInGrid(state.currentCard ? state.currentCard.id : -1);
                state.calledCards.forEach(id => {
                    const cardEl = cardGrid.querySelector(`[data-id='${id}']`);
                    if(cardEl) cardEl.classList.add('called');
                });
            }
            
            function generateIcon(canvas, text) {
                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;
                
                let hash = 0;
                for (let i = 0; i < text.length; i++) {
                    hash = text.charCodeAt(i) + ((hash << 5) - hash);
                }

                const h = hash % 360;
                const s = 70 + (hash % 20);
                const l = 60 + (hash % 20);
                
                ctx.fillStyle = `hsl(${h}, ${s}%, ${l}%)`;
                ctx.fillRect(0, 0, width, height);
                
                ctx.fillStyle = `hsl(${h}, ${s}%, 95%)`;
                
                const shapeType = hash % 4;
                const shapes = Math.abs(hash % 3) + 2;

                for (let i = 0; i < shapes; i++) {
                    const x = (Math.abs(hash * (i + 1) * 13)) % (width * 0.6) + (width * 0.2);
                    const y = (Math.abs(hash * (i + 1) * 17)) % (height * 0.6) + (height * 0.2);
                    const size = (Math.abs(hash * (i + 1) * 19)) % 8 + 5;
                    
                    ctx.beginPath();
                    if (shapeType === 0) { ctx.arc(x, y, size / 2, 0, 2 * Math.PI); } 
                    else if (shapeType === 1) { ctx.rect(x - size / 2, y - size / 2, size, size); } 
                    else if (shapeType === 2) { ctx.moveTo(x, y - size / 2); ctx.lineTo(x + size / 2, y + size / 2); ctx.lineTo(x - size / 2, y + size / 2); ctx.closePath(); } 
                    else { ctx.moveTo(x-size, y-size); ctx.lineTo(x+size, y+size); ctx.strokeStyle = `hsl(${h}, ${s}%, 95%)`; ctx.lineWidth = 2; ctx.stroke(); continue; }
                    ctx.fill();
                }
            }

            function setupFilters() {
                const categories = [translations[state.lang].allFilter, ...new Set(aiConcepts.map(c => c[state.lang].category))];
                filterContainer.innerHTML = '';
                categories.forEach(category => {
                    const button = document.createElement('button');
                    button.textContent = category;
                    button.className = 'px-4 py-2 text-sm font-medium rounded-full transition-colors';
                    button.dataset.filter = category;
                    if (category === state.activeFilter) {
                         button.classList.add('bg-blue-500', 'text-white');
                    } else {
                         button.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                    }
                    button.addEventListener('click', () => applyFilter(category));
                    filterContainer.appendChild(button);
                });
            }

            function applyFilter(category) {
                state.activeFilter = category;
                updateGridHighlights();
                setupFilters();
            }

            function updateGridHighlights() {
                const allCards = document.querySelectorAll('.card-grid-item');
                allCards.forEach(cardEl => {
                    cardEl.classList.remove('highlight');
                    if (state.activeFilter !== translations[state.lang].allFilter) {
                        const concept = aiConcepts.find(c => c.id == cardEl.dataset.id);
                        if (concept && concept[state.lang].category === state.activeFilter) {
                            cardEl.classList.add('highlight');
                        }
                    }
                });
            }

            function startGame() {
                state.gameRunning = true;
                state.availableCards = [...aiConcepts.map(c => c.id)];
                state.calledCards = [];
                startButton.textContent = translations[state.lang].nextCardButton;
                drawCard();
            }

            function resetGame() {
                state.gameRunning = false;
                state.availableCards = [];
                state.calledCards = [];
                state.currentCard = null;
                
                startButton.textContent = translations[state.lang].startButton;
                noCardMessage.classList.remove('hidden');
                cardContent.classList.add('hidden');
                
                detailsPlaceholder.classList.remove('hidden');
                detailsContent.classList.add('hidden');

                const allCards = document.querySelectorAll('.card-grid-item');
                allCards.forEach(card => card.classList.remove('called', 'active'));
                
                applyFilter(translations[state.lang].allFilter);
            }

            function drawCard() {
                if (!state.gameRunning) {
                    startGame();
                    return;
                }

                if (state.availableCards.length === 0) {
                    alert(translations[state.lang].lotteryEndMessage);
                    resetGame();
                    return;
                }

                const randomIndex = Math.floor(Math.random() * state.availableCards.length);
                const cardId = state.availableCards.splice(randomIndex, 1)[0];
                
                state.calledCards.push(cardId);
                const concept = aiConcepts.find(c => c.id === cardId);
                state.currentCard = concept;

                updateCalledCardDisplay(concept);
                showDetails(concept.id);
                updateCardInGrid(concept.id, true);
            }

            function updateCalledCardDisplay(concept) {
                const cardData = concept[state.lang];
                noCardMessage.classList.add('hidden');
                cardContent.classList.remove('hidden');
                calledCardName.textContent = cardData.name;
                calledCardCanto.textContent = `"${cardData.canto}"`;
            }

            function showDetails(conceptId) {
                const concept = aiConcepts.find(c => c.id === conceptId);
                if (!concept) return;
                
                state.currentCard = concept;
                const cardData = concept[state.lang];

                detailsPlaceholder.classList.add('hidden');
                detailsContent.classList.remove('hidden');

                detailsTitle.textContent = `${concept.id}. ${cardData.name}`;
                detailsCanto.textContent = `"${cardData.canto}"`;
                detailsAnalysis.innerHTML = `<p>${cardData.analysis.replace(/\n/g, '</p><p>')}</p>`;

                updateCardInGrid(concept.id);
            }

            function updateCardInGrid(conceptId, isNewlyCalled = false) {
                const allCards = document.querySelectorAll('.card-grid-item');
                allCards.forEach(card => {
                    card.classList.remove('active');
                    if (card.dataset.id == conceptId) {
                        card.classList.add('active');
                        if (isNewlyCalled) {
                            card.classList.add('called');
                        }
                    }
                });
            }

            langSwitcher.addEventListener('change', (e) => setLanguage(e.target.value));
            startButton.addEventListener('click', drawCard);
            resetButton.addEventListener('click', resetGame);

            init();
        });
    </script>
</body>
</html>
